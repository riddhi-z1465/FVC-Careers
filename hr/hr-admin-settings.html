<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - HR Portal</title>
    <link rel="icon" type="image/png" href="../images/favicon-v2.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Figtree:wght@300;400;500;600;700;800&family=Manrope:wght@200;300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="hr-jobs.css?v=4">
    <style>
        :root {
            --primary: #1a1a1a;
            --secondary: #666;
            --accent: #2d3436;
            --bg-color: #f8f9fc;
            --card-bg: #ffffff;
            --border-color: #eff0f6;
            --hover-bg: #f8f9fa;
        }

        body {
            font-family: 'Figtree', 'Manrope', sans-serif;
            background-color: var(--bg-color);
            color: var(--primary);
            -webkit-font-smoothing: antialiased;
        }

        .settings-container {
            max-width: 1000px;
            margin: 0 auto;
            padding-bottom: 60px;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 24px;
        }

        .settings-section {
            background: var(--card-bg);
            border-radius: 24px;
            padding: 32px;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.04);
            border: 1px solid rgba(0, 0, 0, 0.03);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        /* Section Header hidden usually, but if needed: */
        .section-header {
            margin-bottom: 24px;
        }

        .add-btn {
            padding: 10px 20px;
            background: black;
            color: white;
            border-radius: 30px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .add-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
            background: #000;
        }

        /* Lists */
        .info-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .info-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 18px 24px;
            border-radius: 16px;
            background: #fff;
            border: 1px solid var(--border-color);
            transition: all 0.2s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        .info-item:hover {
            border-color: #e0e0e0;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.06);
            transform: translateY(-2px);
            z-index: 1;
        }

        .info-item.highlight-admin {
            border-color: #d1c4e9;
            background: #fff;
            box-shadow: 0 4px 20px rgba(103, 58, 183, 0.08);
            /* Purple shadow */
        }

        .info-item.highlight-admin:hover {
            border-color: #9575cd;
            box-shadow: 0 8px 24px rgba(103, 58, 183, 0.15);
        }

        .info-main {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .info-avatar {
            width: 48px;
            height: 48px;
            border-radius: 14px;
            /* Soft square */
            background: #f1f3f5;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 18px;
            color: #555;
            flex-shrink: 0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .info-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .info-details h4 {
            font-size: 16px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 4px;
            font-family: 'Figtree', sans-serif;
        }

        .info-details p {
            font-size: 13px;
            color: #888;
            font-weight: 500;
        }

        .info-right {
            display: flex;
            align-items: center;
            /* Align items horizontally */
            gap: 16px;
        }

        /* Status Badge */
        .info-status {
            font-size: 12px;
            font-weight: 700;
            padding: 6px 12px;
            border-radius: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .info-status.hr {
            background: #e3f2fd;
            color: #1565c0;
        }

        .info-status.admin {
            background: #f3e5f5;
            color: #7b1fa2;
        }

        .info-status.manager {
            background: #e0f2f1;
            color: #00695c;
        }

        /* Check if info-right structure changed in JS, previously flex-col. 
           We'll adjusting for side-by-side now. */

        .info-right {
            flex-direction: row;
            align-items: center;
        }

        .info-actions {
            display: flex;
            gap: 8px;
        }

        .action-icon {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: #555;
            transition: all 0.2s;
            background: transparent;
            border: 1px solid transparent;
        }

        .action-icon:hover {
            background: #f1f3f5;
            color: #000;
        }

        .action-icon.delete:hover {
            background: #ffebee;
            color: #c62828;
        }

        /* Modal Styles */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(4px);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .modal-overlay.show {
            display: flex;
            opacity: 1;
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 28px;
            width: 100%;
            max-width: 480px;
            box-shadow: 0 24px 48px rgba(0, 0, 0, 0.12);
            transform: scale(0.95) translateY(10px);
            transition: transform 0.3s cubic-bezier(0.19, 1, 0.22, 1);
        }

        .modal-overlay.show .modal-content {
            transform: scale(1) translateY(0);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
        }

        .modal-header h2 {
            font-size: 22px;
            font-weight: 800;
            color: var(--primary);
            margin: 0;
            font-family: 'Figtree', sans-serif;
        }

        .close-modal {
            background: #f8f9fa;
            border: none;
            cursor: pointer;
            color: #666;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .close-modal:hover {
            background: #eee;
            color: #000;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            color: #444;
            margin-bottom: 8px;
            font-family: 'Manrope', sans-serif;
        }

        .form-control {
            width: 100%;
            padding: 12px 16px;
            background: #f8f9fc;
            border: 2px solid transparent;
            border-radius: 12px;
            font-size: 15px;
            color: #333;
            transition: all 0.2s;
            box-sizing: border-box;
            font-family: 'Manrope', sans-serif;
        }

        .form-control:focus {
            outline: none;
            background: white;
            border-color: #2d3436;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        .form-control::placeholder {
            color: #aaa;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            margin-top: 32px;
        }

        .btn-cancel {
            padding: 12px 24px;
            background: white;
            color: #666;
            border: 1px solid #ddd;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-cancel:hover {
            background: #f9f9f9;
            border-color: #ccc;
        }

        .btn-save {
            padding: 12px 24px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transition: all 0.2s;
        }

        .btn-save:hover {
            background: #000;
            transform: translateY(-1px);
        }

        /* Tabs */
        .settings-tabs {
            display: inline-flex;
            gap: 8px;
            margin-bottom: 32px;
            background: #e8e8e8;
            padding: 4px;
            border-radius: 100px;
        }

        .tab-btn {
            background: transparent;
            border: none;
            padding: 10px 24px;
            font-size: 14px;
            font-weight: 600;
            color: #666;
            cursor: pointer;
            border-radius: 30px;
            transition: all 0.3s ease;
            font-family: 'Figtree', sans-serif;
        }

        .tab-btn:hover {
            color: #000;
        }

        .tab-btn.active {
            background: white;
            color: #000;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Back Button */
        .page-header {
            margin-bottom: 32px;
        }

        .back-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 16px;
            color: #666;
            text-decoration: none;
            font-weight: 600;
            font-size: 14px;
            transition: color 0.2s;
        }

        .back-btn:hover {
            color: #000;
        }

        .page-header h1 {
            font-family: 'Figtree', sans-serif;
            font-size: 32px;
            font-weight: 800;
            letter-spacing: -0.02em;
            color: var(--primary);
            margin: 0;
        }
    </style>
</head>

<body>
    <!-- Sidebar -->
    <aside class="sidebar-collapsed">
        <div class="sidebar-header">
            <div class="logo-container">
                <img src="../images/fvc-header-logo.png" alt="FVC" class="sidebar-logo">
            </div>
        </div>

        <nav class="sidebar-menu">
            <a href="hr-jobs.html" class="menu-item">
                <span class="menu-icon">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="8" y1="6" x2="21" y2="6"></line>
                        <line x1="8" y1="12" x2="21" y2="12"></line>
                        <line x1="8" y1="18" x2="21" y2="18"></line>
                        <line x1="3" y1="6" x2="3.01" y2="6"></line>
                        <line x1="3" y1="12" x2="3.01" y2="12"></line>
                        <line x1="3" y1="18" x2="3.01" y2="18"></line>
                    </svg>
                </span>
                <span class="menu-text">Active Jobs</span>
            </a>
            <a href="#" class="menu-item active">
                <span class="menu-icon">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"></circle>
                        <path
                            d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1.51 1H15a1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
                        </path>
                    </svg>
                </span>
                <span class="menu-text">Admin</span>
            </a>
        </nav>

        <div class="sidebar-footer">
            <div class="user-profile">
                <div class="user-avatar-circle" id="userAvatarContainer" style="display: none;">
                    <img src="../images/hr-avatar.png" alt="User">
                </div>
                <!-- Admin Profile -->
                <div id="adminAvatarContainer"
                    style="display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; color: #2d3436;">
                    <div
                        style="background: #2d3436; color: white; width: 48px; height: 48px; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <circle cx="12" cy="12" r="3"></circle>
                            <path
                                d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1.51 1H15a1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
                            </path>
                        </svg>
                    </div>
                </div>
                <button class="logout-link" onclick="logout()"
                    style="display:flex; visibility:visible; width:auto; opacity:1; margin-top:8px;">
                    Logout
                </button>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content full-width">
        <header class="page-header">
            <a href="hr-jobs.html" class="back-btn">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 12H5M12 19l-7-7 7-7" />
                </svg>
                Back to Jobs
            </a>
            <h1>Admin Settings</h1>
        </header>

        <div class="settings-container">
            <!-- Tabs Navigation -->
            <div class="settings-tabs">
                <button class="tab-btn active" onclick="switchTab('team')">Internal Team</button>
                <button class="tab-btn" onclick="switchTab('candidates')">Candidates</button>
            </div>

            <div class="settings-grid">
                <!-- Internal Team Section -->
                <div id="teamSection" class="tab-content active">
                    <div style="display: flex; justify-content: flex-end; margin-bottom: 24px;">
                        <button class="add-btn" onclick="openAddMemberModal()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="3">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                            Add Member
                        </button>
                    </div>
                    <div class="settings-section">
                        <div class="info-list" id="teamList">
                            <!-- Items rendered via JS -->
                        </div>
                    </div>
                </div>

                <!-- Candidates Information Section -->
                <div id="candidatesSection" class="tab-content">
                    <div style="display: flex; justify-content: flex-end; margin-bottom: 24px;">
                        <button class="add-btn" style="background:#555;">Export CSV</button>
                    </div>
                    <div class="settings-section">
                        <div class="info-list" id="candidatesList">
                            <!-- Loading placeholder -->
                            <div style="text-align:center; color:#999; padding:20px;">Loading candidates...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Edit Admin Modal -->
    <div class="modal-overlay" id="editModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Edit Team Member</h2>
                <button class="close-modal" onclick="closeEditModal()">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <form id="editForm" onsubmit="saveMemberChanges(event)">
                <input type="hidden" id="editMemberId">

                <!-- Profile Photo Section -->
                <div class="form-group"
                    style="display: flex; flex-direction: column; align-items: center; margin-bottom: 24px;">
                    <div id="editPhotoPreview"
                        style="width: 80px; height: 80px; border-radius: 50%; background: #f1f3f5; margin-bottom: 12px; overflow: hidden; display: flex; align-items: center; justify-content: center; font-size: 28px; font-weight: 700; color: #636e72;">
                        <!-- Content via JS -->
                    </div>
                    <input type="file" id="editPhotoInput" accept="image/*" style="display: none;"
                        onchange="handlePhotoSelect(this)">
                    <button type="button" onclick="document.getElementById('editPhotoInput').click()"
                        style="background:none; border:none; color: #2d3436; font-weight: 600; font-size: 14px; cursor: pointer; text-decoration: underline;">
                        Change Profile Photo
                    </button>
                </div>

                <div class="form-group">
                    <label>Full Name</label>
                    <input type="text" class="form-control" id="editName" required>
                </div>

                <div class="form-group">
                    <label>Email Address</label>
                    <input type="email" class="form-control" id="editEmail" required>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                    <div class="form-group">
                        <label>Designation / Role</label>
                        <input type="text" class="form-control" id="editRole" required>
                    </div>
                    <div class="form-group">
                        <label>Team Name</label>
                        <input type="text" class="form-control" id="editTeam" placeholder="e.g. Executive">
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                    <div class="form-group">
                        <label>Username</label>
                        <input type="text" class="form-control" id="editUsername" required>
                    </div>
                    <div class="form-group">
                        <label>Member Code</label>
                        <input type="text" class="form-control" id="editCode" required>
                    </div>
                </div>

                <div class="form-group">
                    <label>Password</label>
                    <input type="text" class="form-control" id="editPassword" required>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn-cancel" onclick="closeEditModal()">Cancel</button>
                    <button type="submit" class="btn-save">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Member Modal -->
    <div class="modal-overlay" id="addMemberModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add New Member</h2>
                <button class="close-modal" onclick="closeAddMemberModal()">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <form id="addMemberForm" onsubmit="saveNewMember(event)">
                <!-- Profile Photo Section -->
                <div class="form-group"
                    style="display: flex; flex-direction: column; align-items: center; margin-bottom: 24px;">
                    <div id="addPhotoPreview"
                        style="width: 80px; height: 80px; border-radius: 50%; background: #f1f3f5; margin-bottom: 12px; overflow: hidden; display: flex; align-items: center; justify-content: center; font-size: 28px; font-weight: 700; color: #636e72;">
                        +
                    </div>
                    <input type="file" id="addPhotoInput" accept="image/*" style="display: none;"
                        onchange="handleAddPhotoSelect(this)">
                    <button type="button" onclick="document.getElementById('addPhotoInput').click()"
                        style="background:none; border:none; color: #2d3436; font-weight: 600; font-size: 14px; cursor: pointer; text-decoration: underline;">
                        Upload Photo
                    </button>
                </div>

                <div class="form-group">
                    <label>Full Name</label>
                    <input type="text" class="form-control" id="addName" required placeholder="e.g. John Doe">
                </div>

                <div class="form-group">
                    <label>Email Address</label>
                    <input type="email" class="form-control" id="addEmail" required placeholder="e.g. john@company.com">
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                    <div class="form-group">
                        <label>Role</label>
                        <select class="form-control" id="addRole" required>
                            <option value="hr">HR Admin</option>
                            <option value="manager">Manager</option>
                            <option value="admin">System Admin</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Team Name</label>
                        <input type="text" class="form-control" id="addTeam" placeholder="e.g. Recruiting">
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                    <div class="form-group">
                        <label>Username</label>
                        <input type="text" class="form-control" id="addUsername" required placeholder="jdoe">
                    </div>
                    <div class="form-group">
                        <label>Member Code</label>
                        <input type="text" class="form-control" id="addCode" value="FVC2025" required>
                    </div>
                </div>

                <div class="form-group">
                    <label>Password</label>
                    <input type="text" class="form-control" id="addPassword" required value="password123">
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn-cancel" onclick="closeAddMemberModal()">Cancel</button>
                    <button type="submit" class="btn-save">Create Member</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Candidate Modal -->
    <div class="modal-overlay" id="candidateModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Edit Application Status</h2>
                <button class="close-modal" onclick="closeCandidateModal()">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <form id="candidateForm" onsubmit="saveCandidateStatus(event)">
                <input type="hidden" id="candidateId">

                <div class="form-group">
                    <label>Candidate Name</label>
                    <input type="text" class="form-control" id="candidateName" readonly
                        style="background-color: #f9f9f9;">
                </div>

                <div class="form-group">
                    <label>Role Applied</label>
                    <input type="text" class="form-control" id="candidateRole" readonly
                        style="background-color: #f9f9f9;">
                </div>

                <div class="form-group">
                    <label>Application Status</label>
                    <div style="position: relative;">
                        <select class="form-control" id="candidateStatus" required
                            style="appearance: none; background-color: white;">
                            <option value="New">New</option>
                            <option value="Reviewing">Reviewing</option>
                            <option value="Shortlisted">Shortlisted</option>
                            <option value="Interview">Interview</option>
                            <option value="Rejected">Rejected</option>
                            <option value="Hired">Hired</option>
                        </select>
                        <svg style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); pointer-events: none; color: #666;"
                            width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn-cancel" onclick="closeCandidateModal()">Cancel</button>
                    <button type="submit" class="btn-save">Update Status</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Scripts -->
    <!-- Reuse simple logic for now, or link to a js file -->
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>

    <!-- Firebase Config & Services -->
    <script src="../js/firebase-config.js"></script>
    <script src="../js/firebase-jobs.js?v=2"></script>

    <script>
        function logout() {
            sessionStorage.removeItem('hrLoggedIn');
            sessionStorage.removeItem('hrRole');
            window.location.href = 'hr-login.html';
        }

        // Initialize Data
        let teamMembers = [];

        // Internal Team Data (Default / Seed)
        const defaultTeam = [
            { id: 1, name: 'Admin User', role: 'admin', team: 'Executive', username: 'admin', password: 'admin123', code: 'ADMIN2025', email: 'admin@fvc.com', displayRole: 'Admin' },
            { id: 2, name: 'HR Admin', role: 'hr', team: 'Human Resources', username: 'hr_admin', password: 'hr123', code: 'FVC2025', email: 'hr_admin@fvc.com', displayRole: 'HR Admin' },
            { id: 3, name: 'Recruiter', role: 'hr', team: 'Talent Acquisition', username: 'recruiter', password: 'rec123', code: 'FVC2025', email: 'recruiter@fvc.com', displayRole: 'Recruiter' },
            { id: 4, name: 'Hiring Manager', role: 'manager', team: 'Engineering', username: 'hiring_manager', password: 'hm123', code: 'FVC2025', email: 'manager@fvc.com', displayRole: 'Manager' },
            { id: 5, name: 'Talent Scout', role: 'hr', team: 'Sourcing', username: 'talent_scout', password: 'ts123', code: 'FVC2025', email: 'scout@fvc.com', displayRole: 'Talent Scout' }
        ];

        let candidatesData = []; // Store candidates globally to access in modal
        let currentEditPhoto = null; // Temp store for photo being edited
        let currentAddPhoto = null; // Temp store for new member photo

        document.addEventListener('DOMContentLoaded', async () => {
            loadTeamData();
            renderTeam();
            await loadCandidates();
        });

        function loadTeamData() {
            const stored = localStorage.getItem('fvc_team_members');
            if (stored) {
                teamMembers = JSON.parse(stored);
            } else {
                teamMembers = [...defaultTeam];
                saveTeamData();
            }
        }

        function saveTeamData() {
            localStorage.setItem('fvc_team_members', JSON.stringify(teamMembers));
        }

        // Tab Switching Logic
        function switchTab(tab) {
            // Update buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent.toLowerCase().includes(tab === 'team' ? 'internal team' : 'candidates')) {
                    btn.classList.add('active');
                }
            });

            // Update content sections
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });

            if (tab === 'team') {
                document.getElementById('teamSection').classList.add('active');
            } else {
                document.getElementById('candidatesSection').classList.add('active');
            }
        }

        // Render Team List
        function renderTeam() {
            const list = document.getElementById('teamList');
            if (!list) return;

            list.innerHTML = teamMembers.map(member => {
                const isAdmin = member.role === 'admin';
                // Force Grey avatar for Admin to match image, otherwise dynamic color
                const avatarStyle = isAdmin ? 'background-color: #eeeeee; color: #555;' : '';

                return `
                <div class="info-item ${isAdmin ? 'highlight-admin' : ''}">
                    <div class="info-main">
                        <div class="info-avatar" style="${avatarStyle}">
                            ${member.photo
                        ? `<img src="${member.photo}" style="width:100%; height:100%; object-fit:cover;">`
                        : (isAdmin ? 'A' : getAvatar(member.name))}
                        </div>
                        <div class="info-details">
                            <h4>${member.name}</h4>
                            <p>${member.email} <span style="color:#ccc">•</span> <span style="font-size:12px; color:#999;">${member.team || 'General'}</span></p>
                        </div>
                    </div>
                    <div class="info-right">
                        <span class="info-status ${member.role === 'admin' ? 'admin' : (member.role === 'manager' ? 'manager' : 'hr')}">${member.displayRole}</span>
                        <div class="info-actions">
                            <button class="action-icon" title="Edit" onclick="openEditModal(${member.id})">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                </svg>
                            </button>
                            ${!isAdmin ? `
                            <button class="action-icon delete" title="Remove" onclick="deleteMember(${member.id})">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="3 6 5 6 21 6"></polyline>
                                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                </svg>
                            </button>` : ''}
                        </div>
                    </div>
                </div>
            `}).join('');
        }

        // Modal Functions
        function openEditModal(id) {
            const member = teamMembers.find(m => m.id === id);
            if (!member) return;

            document.getElementById('editMemberId').value = member.id;
            document.getElementById('editName').value = member.name;
            document.getElementById('editEmail').value = member.email;
            document.getElementById('editRole').value = member.displayRole;
            document.getElementById('editTeam').value = member.team || '';
            document.getElementById('editUsername').value = member.username;
            document.getElementById('editPassword').value = member.password;
            document.getElementById('editCode').value = member.code;

            // Handle Photo Preview
            currentEditPhoto = member.photo || null; // Reset/Load current
            const preview = document.getElementById('editPhotoPreview');
            if (currentEditPhoto) {
                preview.innerHTML = `<img src="${currentEditPhoto}" style="width:100%; height:100%; object-fit:cover;">`;
            } else {
                // Fallback to initial logic purely for visual
                const initial = member.name.charAt(0).toUpperCase();
                preview.innerHTML = initial;
            }

            document.getElementById('editModal').classList.add('show');
        }

        // Handle File Input
        function handlePhotoSelect(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    currentEditPhoto = e.target.result; // Base64 string
                    // Update preview
                    document.getElementById('editPhotoPreview').innerHTML = `<img src="${currentEditPhoto}" style="width:100%; height:100%; object-fit:cover;">`;
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        function closeEditModal() {
            document.getElementById('editModal').classList.remove('show');
        }

        function saveMemberChanges(event) {
            event.preventDefault();

            const id = parseInt(document.getElementById('editMemberId').value);
            const index = teamMembers.findIndex(m => m.id === id);

            if (index !== -1) {
                teamMembers[index] = {
                    ...teamMembers[index],
                    name: document.getElementById('editName').value,
                    email: document.getElementById('editEmail').value,
                    displayRole: document.getElementById('editRole').value,
                    team: document.getElementById('editTeam').value,
                    username: document.getElementById('editUsername').value,
                    password: document.getElementById('editPassword').value,
                    code: document.getElementById('editCode').value,
                    photo: currentEditPhoto // Save the photo
                };

                saveTeamData();
                renderTeam();
                closeEditModal();
                // Optional: Show success toast
            }
        }

        function deleteMember(id) {
            if (confirm('Are you sure you want to remove this team member?')) {
                teamMembers = teamMembers.filter(m => m.id !== id);
                saveTeamData();
                renderTeam();
            }
        }

        // Add Member Functions
        function openAddMemberModal() {
            document.getElementById('addMemberForm').reset();
            currentAddPhoto = null;
            document.getElementById('addPhotoPreview').innerHTML = '+';
            document.getElementById('addMemberModal').classList.add('show');
        }

        function closeAddMemberModal() {
            document.getElementById('addMemberModal').classList.remove('show');
        }

        function handleAddPhotoSelect(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    currentAddPhoto = e.target.result;
                    document.getElementById('addPhotoPreview').innerHTML = `<img src="${currentAddPhoto}" style="width:100%; height:100%; object-fit:cover;">`;
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        function saveNewMember(event) {
            event.preventDefault();

            const newMember = {
                id: Date.now(), // Simple unique ID
                name: document.getElementById('addName').value,
                email: document.getElementById('addEmail').value,
                role: document.getElementById('addRole').value,
                displayRole: document.getElementById('addRole').options[document.getElementById('addRole').selectedIndex].text,
                team: document.getElementById('addTeam').value,
                username: document.getElementById('addUsername').value,
                password: document.getElementById('addPassword').value,
                code: document.getElementById('addCode').value,
                photo: currentAddPhoto
            };

            teamMembers.push(newMember);
            saveTeamData();
            renderTeam();
            closeAddMemberModal();
        }

        // Load Candidates from Firebase
        async function loadCandidates() {
            const list = document.getElementById('candidatesList');
            if (!list) return;

            let candidates = [];

            // 1. Try Firebase
            if (typeof firebaseJobs !== 'undefined' && firebaseJobs.fetchAllApplications) {
                try {
                    const result = await firebaseJobs.fetchAllApplications();
                    if (result.success && result.data) {
                        candidates = result.data.map(app => ({
                            id: app.id,
                            name: app.fullName || app.name || 'Unknown',
                            role: app.targetRole || 'Applicant',
                            email: app.email || 'No email',
                            status: app.status || 'New',
                            avatar: app.photoURL
                        }));
                    }
                } catch (e) {
                    console.error('Error fetching firebase candidates:', e);
                }
            }

            // 2. Merge/Fallback to LocalStorage
            try {
                const localApps = JSON.parse(localStorage.getItem('applications') || '[]');
                const localMapped = localApps.map((app, index) => ({
                    id: app.id || `local_${index}`,
                    name: app.fullName || app.name || 'Unknown',
                    role: app.targetRole || 'Applicant',
                    email: app.email,
                    status: app.status || 'New',
                    avatar: null // Local apps usually don't have persistent photo URLs
                }));

                // Avoid duplicates if firebase loaded same data (simple check by name/email if needed, strictly pushing for now)
                // Filter out local apps that might already be in firebase list if IDs match
                const firebaseIds = new Set(candidates.map(c => c.id));
                const uniqueLocal = localMapped.filter(c => !firebaseIds.has(c.id));
                candidates = [...candidates, ...uniqueLocal];

            } catch (e) {
                console.error('Error fetching local candidates:', e);
            }

            candidatesData = candidates; // Update global store

            if (candidates.length === 0) {
                list.innerHTML = '<div style="text-align:center; padding: 30px; color:#888;">No candidates found.</div>';
                return;
            }

            list.innerHTML = candidates.map(c => `
                <div class="info-item">
                    <div class="info-main">
                        <div class="info-avatar" style="${c.avatar ? '' : `background-color:${getColor(c.name)}20; color:${getColor(c.name)}`}">
                            ${c.avatar ? `<img src="${c.avatar}" alt="${c.name}">` : c.name.charAt(0).toUpperCase()}
                        </div>
                        <div class="info-details">
                            <h4>${c.name}</h4>
                            <p>${c.role} • ${c.email}</p>
                        </div>
                    </div>
                    <div class="info-right">
                        <span class="info-status" style="background-color:${getStatusColor(c.status).bg}; color:${getStatusColor(c.status).text}">${capitalize(c.status)}</span>
                        <div class="info-actions">
                            <button class="action-icon" title="Edit Status" onclick="openCandidateModal('${c.id}')">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                </svg>
                            </button>
                            <button class="action-icon delete" title="Delete" onclick="deleteCandidate('${c.id}')">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="3 6 5 6 21 6"></polyline>
                                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function openCandidateModal(id) {
            const candidate = candidatesData.find(c => c.id === id);
            if (!candidate) return;

            document.getElementById('candidateId').value = candidate.id;
            document.getElementById('candidateName').value = candidate.name;
            document.getElementById('candidateRole').value = candidate.role;
            document.getElementById('candidateStatus').value = capitalize(candidate.status); // Determine best match

            // Handle case mismatch or custom status
            const statusSelect = document.getElementById('candidateStatus');
            const options = Array.from(statusSelect.options).map(o => o.value);
            // If current status isn't in standard list, default to closest or add logical fallback
            let matched = false;
            for (let opt of options) {
                if (opt.toLowerCase() === candidate.status.toLowerCase()) {
                    statusSelect.value = opt;
                    matched = true;
                    break;
                }
            }
            if (!matched) statusSelect.value = 'New';

            document.getElementById('candidateModal').classList.add('show');
        }

        function closeCandidateModal() {
            document.getElementById('candidateModal').classList.remove('show');
        }

        async function saveCandidateStatus(event) {
            event.preventDefault();
            const id = document.getElementById('candidateId').value;
            const newStatus = document.getElementById('candidateStatus').value;
            const submitBtn = event.target.querySelector('.btn-save');
            const originalText = submitBtn.textContent;

            submitBtn.textContent = 'Updating...';
            submitBtn.disabled = true;

            try {
                // 1. Update Firebase if available
                let updated = false;
                if (typeof firebaseJobs !== 'undefined' && firebaseJobs.updateApplicationStatus) {
                    const result = await firebaseJobs.updateApplicationStatus(id, newStatus);
                    if (result.success) updated = true;
                }

                // 2. Update LocalStorage (always try to sync local state)
                const localApps = JSON.parse(localStorage.getItem('applications') || '[]');
                const localIndex = localApps.findIndex(app => app.id === id || `local_${localApps.indexOf(app)}` === id);

                if (localIndex !== -1) {
                    localApps[localIndex].status = newStatus;
                    localStorage.setItem('applications', JSON.stringify(localApps));
                    updated = true;
                } else if (!id.startsWith('local_')) {
                    // It was a firebase ID but maybe we are in hybrid mode?
                    // If firebase update succeeded, we are good.
                }

                if (updated || id.startsWith('local_')) { // Assume success for local mock interactions if we found the item
                    closeCandidateModal();
                    await loadCandidates(); // Refresh list
                } else {
                    alert('Failed to update status. Please check your connection.');
                }
            } catch (error) {
                console.error('Update failed:', error);
                alert('An error occurred while updating status.');
            } finally {
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        }

        function deleteCandidate(id) {
            if (confirm('Are you sure you want to delete this candidate application?')) {
                // Implement delete logic similar to save
                // For now, let's just do local storage
                const localApps = JSON.parse(localStorage.getItem('applications') || '[]');
                const newApps = localApps.filter((app, index) => (app.id !== id && `local_${index}` !== id));
                if (localApps.length !== newApps.length) {
                    localStorage.setItem('applications', JSON.stringify(newApps));
                    loadCandidates();
                } else {
                    alert('Delete from database not fully implemented in this view (requires backend auth). Local copy cleared if present.');
                    // Force refresh to clear UI if it was memory-only for demo
                    loadCandidates();
                }
            }
        }

        function getAvatar(name) {
            // Check if name implies a specific image we have, otherwise return initial
            // For now, just return initial logic or simple image if we had one
            if (name === 'Sarah Jenkins') return `<img src="../images/hr-avatar.png" alt="${name}">`;
            return `<span>${name.charAt(0).toUpperCase()}</span>`;
        }

        function getColor(name) {
            const colors = ['#e74c3c', '#3498db', '#9b59b6', '#2ecc71', '#f1c40f', '#e67e22'];
            return colors[name.length % colors.length];
        }

        function getStatusColor(status) {
            const s = status.toLowerCase();
            if (s === 'new' || s === 'applied') return { bg: '#e3f2fd', text: '#1565c0' };
            if (s === 'shortlisted') return { bg: '#e8f5e9', text: '#2e7d32' };
            if (s === 'rejected') return { bg: '#ffebee', text: '#c62828' };
            if (s === 'in progress' || s === 'interview') return { bg: '#fff3e0', text: '#ef6c00' };
            return { bg: '#f5f5f5', text: '#666' };
        }

        function capitalize(str) {
            return str ? str.charAt(0).toUpperCase() + str.slice(1) : '';
        }
    </script>
</body>

</html>